<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Today's Holidays</title>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; background-color: #f9f9f9; }
  h1 { color: #333; }
  h2 { color: #555; margin-top: 30px; }
  .holiday { background: white; padding: 15px; margin-bottom: 10px; border-radius: 5px; box-shadow: 1px 1px 5px rgba(0,0,0,0.1); }
  .icon { font-weight: bold; color: #d22; margin-right: 8px; }
</style>
</head>
<body>

<h1>Today's Holidays</h1>

<h2>Mental Health Awareness</h2>
<div id="mentalHolidays">Loading...</div>

<h2>LGBTQ+ Awareness</h2>
<div id="lgbtqHolidays">Loading...</div>

<script>
function getNthWeekdayOfMonth(year, month, weekday, n) {
    const date = new Date(year, month-1, 1);
    let count = 0;
    while (date.getMonth() === month-1) {
        if (date.getDay() === weekday) {
            count++;
            if (count === n) return date.getDate();
        }
        date.setDate(date.getDate() + 1);
    }
    return null;
}

function isTodayMentalHoliday(holiday, today) {
    const month = today.getMonth() + 1;
    const day = today.getDate();
    const year = today.getFullYear();

    if (holiday.month !== month) return false;

    if (holiday.type === 'day' && holiday.rule) {
        switch (holiday.rule.kind) {
            case 'fixed':
                return day === holiday.rule.day;
            case 'nthWeekdayOfMonth':
                return day === getNthWeekdayOfMonth(year, month, holiday.rule.weekday, holiday.rule.nth);
            case 'nthWeek':
                // simple approximation: first day of nth week
                const firstDayOfMonth = new Date(year, month-1, 1).getDay();
                const targetDay = (holiday.rule.which === 'first' ? 1 : holiday.rule.which === 'second' ? 8 : 15); // rough
                return day === targetDay;
            // Add more rules as needed
        }
    } else if (holiday.type === 'month') {
        return true; // display whole month
    }
    return false;
}

async function loadHolidays() {
    const mentalContainer = document.getElementById('mentalHolidays');
    const lgbtqContainer = document.getElementById('lgbtqHolidays');
    const today = new Date();
    const month = today.getMonth() + 1;
    const day = today.getDate();

    // Mental Health
    try {
        const res = await fetch('days.json');
        const mentalData = await res.json();
        const todaysMental = mentalData.filter(h => isTodayMentalHoliday(h, today));

        if (todaysMental.length === 0) mentalContainer.innerHTML = "<p>No holidays today.</p>";
        else {
            mentalContainer.innerHTML = '';
            todaysMental.forEach(h => {
                const div = document.createElement('div');
                div.className = 'holiday';
                div.innerHTML = `${h.name}${h.note ? ' - ' + h.note : ''}`;
                mentalContainer.appendChild(div);
            });
        }
    } catch(e) {
        console.error(e);
        mentalContainer.innerHTML = "<p>Failed to load holidays.</p>";
    }

    // LGBTQ+ Holidays (simple fixed date)
    try {
        const res2 = await fetch('days2.json');
        const lgbtqData = await res2.json();
        const todaysLGBTQ = lgbtqData.filter(h => h.month === month && day >= h.day_start && day <= (h.day_end || h.day_start));

        if (todaysLGBTQ.length === 0) lgbtqContainer.innerHTML = "<p>No holidays today.</p>";
        else {
            lgbtqContainer.innerHTML = '';
            todaysLGBTQ.forEach(h => {
                const div = document.createElement('div');
                div.className = 'holiday';
                div.innerHTML = `${h.icon || ''} ${h.name}`;
                lgbtqContainer.appendChild(div);
            });
        }
    } catch(e) {
        console.error(e);
        lgbtqContainer.innerHTML = "<p>Failed to load LGBTQ+ holidays.</p>";
    }
}

loadHolidays();
</script>
</body>
</html>
